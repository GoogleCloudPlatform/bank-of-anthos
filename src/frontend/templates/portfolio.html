<!--
Copyright 2024 Google LLC

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

    https://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
-->

<html lang="en">
  <head>
{% include 'shared/html_head.html' %}
  </head>
  <body>
{% include 'shared/platform_banner.html' %}
{% include 'shared/navigation.html' %}
    <!-- Main Content -->
    <main class="container">
      <!-- Alert on load -->
    {% if message != None %}
      <div class="row col-lg-12 align-items-start" id="alert-message-div" >
        <div class="col-lg">
            <div class="card snackbar-card">
              <div class="card-body snackbar-body">
                <div class="row align-items-center">
                  <div class="col">
                    <h5 id="alert-message" class="alert-message-container">
                      <div class="check-mark-container">
                        <span class="snackbar-close material-icons">check_circle</span>
                      </div>
                      {{ message }}
                    </h5>
                  </div>
                  <div class="button-icon col-auto">
                    <span class="snackbar-close material-icons" onclick="$('#alert-message-div').remove();">close</span>
                  </div>
                </div>
              </div>
          </div>
        </div>
      </div>
    {% endif %}

      <!-- Top row - Portfolio overview -->
      <div class="row col-lg-12 align-items-start top-row">
        <div class="col-md-8">
          <small class="text-uppercase text-muted secondary-text">Investment Portfolio</small>
          <h2 class="header-title">Portfolio Management</h2>
        </div>

        <div class="col-md-4 account-info text-right">
            <p>
              <span class="account-overview account-icon material-icons">account_balance</span>
              <span class="account-num-text">Account Number:</span><span class="account-number">{{ account_id }}</span>
            </p>
        </div>
    </div>

    <!-- Portfolio Overview -->
    {% if portfolio %}
    <div class="row col-lg-12 align-items-start mb-4">
      <div class="col-lg-12">
        <div class="card">
          <div class="card-body">
            <div class="row align-items-center">
              <div class="col">
                <h4 class="card-title">Portfolio Overview</h4>
                <p class="text-muted">Total Portfolio Value: <span class="h3 text-primary">{{ format_currency(portfolio.total_value) }}</span></p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Tier Allocations -->
    <div class="row col-lg-12 align-items-start mb-4">
      <div class="col-lg-4">
        <div class="card">
          <div class="card-body">
            <div class="row align-items-center">
              <div class="col">
                <h5 class="card-title text-primary">Tier 1 (Conservative)</h5>
                <p class="text-muted">Allocation: {{ "%.1f"|format(portfolio.tier1_allocation) }}%</p>
                <p class="h4">{{ format_currency(portfolio.tier1_value) }}</p>
              </div>
              <div class="col-auto">
                <span class="material-icons text-primary" style="font-size: 2rem;">security</span>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="col-lg-4">
        <div class="card">
          <div class="card-body">
            <div class="row align-items-center">
              <div class="col">
                <h5 class="card-title text-warning">Tier 2 (Moderate)</h5>
                <p class="text-muted">Allocation: {{ "%.1f"|format(portfolio.tier2_allocation) }}%</p>
                <p class="h4">{{ format_currency(portfolio.tier2_value) }}</p>
              </div>
              <div class="col-auto">
                <span class="material-icons text-warning" style="font-size: 2rem;">trending_up</span>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="col-lg-4">
        <div class="card">
          <div class="card-body">
            <div class="row align-items-center">
              <div class="col">
                <h5 class="card-title text-danger">Tier 3 (Aggressive)</h5>
                <p class="text-muted">Allocation: {{ "%.1f"|format(portfolio.tier3_allocation) }}%</p>
                <p class="h4">{{ format_currency(portfolio.tier3_value) }}</p>
              </div>
              <div class="col-auto">
                <span class="material-icons text-danger" style="font-size: 2rem;">rocket_launch</span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    {% else %}
    <div class="row col-lg-12 align-items-start mb-4">
      <div class="col-lg-12">
        <div class="card">
          <div class="card-body text-center">
            <h4 class="card-title">No Portfolio Found</h4>
            <p class="text-muted">You don't have an investment portfolio yet. Start by making your first investment!</p>
          </div>
        </div>
      </div>
    </div>
    {% endif %}

    <!-- Action Buttons -->
    <div class="row col-lg-12 align-items-start mb-4">
      <div class="col-lg-6">
        <div class="card card-button" data-toggle="modal" data-target="#investModal" data-keyboard="false" data-backdrop="static">
          <div class="card-body">
            <div class="row align-items-center">
              <div class="col">
                <span class="h5 mb-0">Invest More</span>
              </div>
              <div class="button-icon col-auto">
                <span class="material-icons text-success">add_circle</span>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="col-lg-6">
        <div class="card card-button" data-toggle="modal" data-target="#withdrawModal" data-keyboard="false" data-backdrop="static">
          <div class="card-body">
            <div class="row align-items-center">
              <div class="col">
                <span class="h5 mb-0">Withdraw Funds</span>
              </div>
              <div class="button-icon col-auto">
                <span class="material-icons text-warning">remove_circle</span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Transaction History -->
    <div class="row col-lg-12 mb-4 align-items-start">
      <div class="col-lg-12">
        <div class="card">
          <div class="card-table-header">
            <div class="row align-items-start">
              <div class="col">
                <h4 class="card-header-title">Portfolio Transactions</h4>
              </div>
            </div>
          </div>
          <div class="table-responsive mb-0" id="transaction-table">
          {% if transactions is none %}
            <h4 class="card-table-header">Error: Could Not Load Transactions</h4>
          {% elif transactions|length == 0 %}
            <h4 class="card-table-header">No Transactions Found</h4>
          {% else %}
            <table class="table table-sm table-nowrap card-table">
              <thead class="text-uppercase">
                <tr>
                  <th>Date</th>
                  <th>Type</th>
                  <th>Amount</th>
                  <th>Tier 1</th>
                  <th>Tier 2</th>
                  <th>Tier 3</th>
                  <th>Status</th>
                </tr>
              </thead>
              <tbody class="list" id="transaction-list">
              {% for t in transactions %}
                <tr>
                  <td class="text-uppercase transaction-date">
                    <p>{{ format_timestamp_month(t.created_at) }} {{ format_timestamp_day(t.created_at) }}</p>
                  </td>
                  <td class="transaction-type">
                    {% if t.transaction_type == 'DEPOSIT' %}
                      <span class="text-success">●</span> Investment
                    {% elif t.transaction_type == 'WITHDRAWAL' %}
                      <span class="text-warning">●</span> Withdrawal
                    {% else %}
                      <span class="text-info">●</span> {{ t.transaction_type }}
                    {% endif %}
                  </td>
                  <td class="transaction-amount">
                    {% if t.transaction_type == 'DEPOSIT' %}
                      <span class="text-success">+{{ format_currency(t.amount) }}</span>
                    {% else %}
                      <span class="text-warning">-{{ format_currency(t.amount) }}</span>
                    {% endif %}
                  </td>
                  <td class="text-muted">{{ format_currency(t.tier1_amount) }}</td>
                  <td class="text-muted">{{ format_currency(t.tier2_amount) }}</td>
                  <td class="text-muted">{{ format_currency(t.tier3_amount) }}</td>
                  <td>
                    <span class="badge badge-success">Completed</span>
                  </td>
                </tr>
              {% endfor %}
              </tbody>
            </table>
          {% endif %}
          </div>
        </div>
      </div>
    </div>

    </main>

    <!-- Invest Modal -->
    <div class="modal fade" id="investModal" tabindex="-1" role="dialog" aria-labelledby="investModalLabel" aria-hidden="true">
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="investModalLabel">Invest Funds</h5>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <form method="POST" action="/portfolio/invest">
            <div class="modal-body">
              <div class="form-group">
                <label for="investAmount">Investment Amount</label>
                <div class="input-group">
                  <div class="input-group-prepend">
                    <span class="input-group-text">$</span>
                  </div>
                  <input type="number" class="form-control" id="investAmount" name="amount" step="0.01" min="0.01" required>
                </div>
                <small class="form-text text-muted">Enter the amount you want to invest. Funds will be allocated across tiers based on your risk profile.</small>
              </div>
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
              <button type="submit" class="btn btn-success">Invest</button>
            </div>
          </form>
        </div>
      </div>
    </div>

    <!-- Withdraw Modal -->
    <div class="modal fade" id="withdrawModal" tabindex="-1" role="dialog" aria-labelledby="withdrawModalLabel" aria-hidden="true">
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="withdrawModalLabel">Withdraw Funds</h5>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <form method="POST" action="/portfolio/withdraw">
            <div class="modal-body">
              <div class="form-group">
                <label for="withdrawAmount">Withdrawal Amount</label>
                <div class="input-group">
                  <div class="input-group-prepend">
                    <span class="input-group-text">$</span>
                  </div>
                  <input type="number" class="form-control" id="withdrawAmount" name="amount" step="0.01" min="0.01" required>
                </div>
                <small class="form-text text-muted">Enter the amount you want to withdraw from your portfolio.</small>
              </div>
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
              <button type="submit" class="btn btn-warning">Withdraw</button>
            </div>
          </form>
        </div>
      </div>
    </div>

{% include 'shared/footer.html' %}
{% include 'shared/scripts.html' %}
  </body>
</html>
